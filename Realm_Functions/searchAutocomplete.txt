exports = async function(payload, response){


   const postbody = EJSON.parse(payload.body.text())

   console.log("Payload--"+JSON.stringify(postbody));

    // Querying a mongodb service:
     const collection = context.services.get("mongodb-atlas").db("sample_restaurants").collection("restaurants");
     let pipeline = [
       {
        $search:{index:"autocompleteRestaurants",
        "autocomplete":{
         "query":postbody.query,
         "path":"name",
         "tokenOrder":"sequential",
          'fuzzy': {
              'maxEdits': 2,
              'prefixLength': 3
          }
        }
       }
     },{
       $limit:10
     },{
       $project:{
          "_id":0,
         "name":1

       }
     }
     ];

    //let resp = await collection.aggregate(pipeline);
    /*console.log("Response --"+JSON.stringify(restaurants));
    if(restaurants.length ==0){
      return "Sorry unable to get results";
    }*/
    //let restaurants = await collection.aggregate(pipeline);

    let restaurants = collection.aggregate(pipeline).toArray();

    console.log(JSON.stringify(restaurants));

    response.setStatusCode(200);
    response.setHeader("Content-Type", "application/json");
    response.setBody(JSON.stringify(restaurants));

    return response;
};